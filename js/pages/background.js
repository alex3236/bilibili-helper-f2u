/*! For license information please see background.js.LICENSE.txt */
(()=>{"use strict";var t={77050:(t,e,i)=>{i.r(e),i.d(e,{MAX_BIND_NUMBER:()=>n});const n=5},63334:(t,e,i)=>{i.d(e,{Ik:()=>_,xk:()=>g});var n=i(26243),s=i.n(n),r=i(62680),o=i.n(r),a=i(95366),c=i.n(a),d=i(6919),u=i.n(d),h=i(93364),l=i.n(h),f=i(26771),p=i.n(f),m=i(33385);function v(t,e){var i=s()(t);if(o()){var n=o()(t);e&&(n=n.filter((function(e){return c()(t,e).enumerable}))),i.push.apply(i,n)}return i}function y(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?v(Object(i),!0).forEach((function(e){(0,m.Z)(t,e,i[e])})):u()?l()(t,u()(i)):v(Object(i)).forEach((function(e){p()(t,e,c()(i,e))}))}return t}const g={ALL:268435455,REPOST:1,PIC:2,WORD:4,VIDEO:8,DRAMA:32,ARTICLE:64,MUSIC:256,BANGUMI:512,NONE:1024,H5_SHARE:2048,COMIC_SHARE:2049,PGC_BANGUMI:4097,FILM:4098,TV:4099,GUOCHUANG:4100,DOCUMENTARY:4101,LIVE_ROOM:4200,LIVE:4201,MEDIA_LIST:4300,CHEESE_SERIES:4302,CHEESE_UPDATE:4303,HOT:1e3,LIVE_PUSH:4308,COLLECTION:4310,SUBSCRIPTION:4311,QUICK:1001},_={[g.REPOST]:"\u8f6c\u53d1",[g.PIC]:"\u56fe\u7247",[g.WORD]:"\u6587\u5b57",[g.VIDEO]:"\u89c6\u9891",[g.DRAMA]:"\u620f\u5267",[g.ARTICLE]:"\u6587\u7ae0",[g.MUSIC]:"\u97f3\u4e50",[g.BANGUMI]:"\u756a\u5267",[g.H5_SHARE]:"\u8bdd\u9898",[g.COMIC_SHARE]:"\u6f2b\u753b",[g.PGC_BANGUMI]:"\u756a\u5267",[g.FILM]:"\u7535\u5f71",[g.TV]:"\u7535\u89c6/\u7efc\u827a",[g.GUOCHUANG]:"\u56fd\u521b",[g.DOCUMENTARY]:"\u7eaa\u5f55\u7247",[g.LIVE_ROOM]:"\u76f4\u64ad\u95f4",[g.LIVE]:"\u76f4\u64ad",[g.MEDIA_LIST]:"\u6536\u85cf\u5939",[g.CHEESE_SERIES]:"\u8bfe\u7a0b",[g.CHEESE_UPDATE]:"\u8bfe\u7a0b\u66f4\u65b0",[g.HOT]:"\u70ed\u95e8",[g.LIVE_PUSH]:"\u76f4\u64ad\uff08\u63a8\u9001\uff09",[g.COLLECTION]:"\u5408\u96c6",[g.SUBSCRIPTION]:"\u76f4\u64ad\uff08\u8ba2\u9605\uff09"};g.ALL,g.PIC,g.WORD,g.VIDEO,g.MEDIA_LIST,g.COLLECTION,g.ARTICLE,g.LIVE_ROOM,g.LIVE,g.LIVE_PUSH,g.SUBSCRIPTION,g.MUSIC,g.BANGUMI,g.PGC_BANGUMI,g.GUOCHUANG,g.COMIC_SHARE,g.CHEESE_SERIES,g.CHEESE_UPDATE,g.FILM,g.TV,g.DOCUMENTARY,g.H5_SHARE,g.COMIC_SHARE,g.DRAMA,g.NONE,y({ALL:268435455,PIC:2,VIDEO:8,ARTICLE:64,BANGUMI:512},g)},15364:(t,e,i)=>{i.d(e,{CUSTOM_WHISPER_MESSAGE:()=>r,SUPER_VIP_USER_IDENTITIES_KEY_LIST:()=>s,VIP_USER_IDENTITIES_KEY_LIST:()=>n});const n=["superAdmin","admin","catForever","catVIP"],s=["superAdmin","admin","catForever"];i(72912);const r={FREE_NUMBER:3,MAX_NUMBER:15,FREE_MAX_LENGTH:30,VIP_MAX_LENGTH:500};i(37873)},80172:(t,e,i)=>{i.r(e),i.d(e,{ItemErrorFactory:()=>o});var n=i(33385),s=i(18281),r=i.n(s);class o{constructor(t){(0,n.Z)(this,"itemName",void 0),(0,n.Z)(this,"errorKeyMap",new(r())),(0,n.Z)(this,"errorCodeMap",new(r())),this.itemName=t}create(t,e=t,i=-(this.errorKeyMap.size+1)){const n={key:t,code:i,i18nKey:"error_"+e};if(this.errorKeyMap.has(t)||this.errorCodeMap.has(i))throw`exist error key or code: ${t}, ${i}`;return this.errorKeyMap.set(t,n),this.errorCodeMap.set(i,n),n}getByKey(t){return this.errorKeyMap.get(t)}getByCode(t){return this.errorCodeMap.get(t)}}},29887:(t,e,i)=>{i.r(e),i.d(e,{Position:()=>a});var n=i(33385),s=i(25733),r=i.n(s);class o{constructor(...t){(0,n.Z)(this,"x",void 0),(0,n.Z)(this,"y",void 0),(0,n.Z)(this,"__valid",!1),(0,n.Z)(this,"__needUpdate",!0),(0,n.Z)(this,"set",(...t)=>{if(isNaN(+t[0])||isNaN(+t[1])){if(t[0]instanceof Array&&2===t[0].length)this.set(...t[0]);else if(t[0]instanceof o){const{x:e,y:i}=t[0];this.set(e,i)}}else this.__needUpdate=!0,this.x=+t[0],this.y=+t[1];return this}),(0,n.Z)(this,"setX",t=>(this.x=t,this.__needUpdate=!0,this)),(0,n.Z)(this,"setY",t=>(this.y=t,this.__needUpdate=!0,this)),(0,n.Z)(this,"add",t=>(this.x+=t.x,this.y+=t.y,this)),(0,n.Z)(this,"addX",t=>(this.x+=t,this)),(0,n.Z)(this,"addY",t=>(this.y+=t,this)),(0,n.Z)(this,"sub",t=>(this.x-=t.x,this.y-=t.y,this)),(0,n.Z)(this,"subX",t=>this.addX(-t)),(0,n.Z)(this,"subY",t=>this.addY(-t)),(0,n.Z)(this,"multiply",t=>0===t?this.set(0,0):(this.x*=t,this.y*=t,this)),(0,n.Z)(this,"multiplyX",t=>(0===t?this.x=1/0:this.x*=t,this)),(0,n.Z)(this,"multiplyY",t=>(0===t?this.y=1/0:this.y*=t,this)),(0,n.Z)(this,"divide",t=>0===t?this.set(1/0,1/0):this.multiply(1/t)),(0,n.Z)(this,"divideX",t=>this.multiplyX(1/t)),(0,n.Z)(this,"divideY",t=>this.multiplyY(1/t)),(0,n.Z)(this,"dot",t=>this.x*t.x+this.y+t.y),(0,n.Z)(this,"equal",(...t)=>{if("number"===typeof t[0]&&"number"===typeof t[1])return t[0]===this.x&&t[1]===this.y;if(t[0]instanceof Array&&2===t.length)return this.equal(...t[0]);if(t[0]instanceof o){const{x:e,y:i}=t[0];return this.equal(e,i)}return!1}),(0,n.Z)(this,"normalize",()=>{const t=Math.sqrt(this.x**2+this.y**2);return this.divide(t)}),(0,n.Z)(this,"negtiveX",()=>(this.x*=-1,this)),(0,n.Z)(this,"negtiveY",()=>(this.y*=-1,this)),(0,n.Z)(this,"negtive",()=>this.negtiveX().negtiveY()),(0,n.Z)(this,"round",()=>(this.x=Math.round(this.x),this.y=Math.round(this.y),this)),(0,n.Z)(this,"roundX",()=>(this.x=Math.round(this.x),this)),(0,n.Z)(this,"roundY",()=>(this.y=Math.round(this.y),this)),(0,n.Z)(this,"floor",()=>(this.x=Math.floor(this.x),this.y=Math.floor(this.y),this)),(0,n.Z)(this,"floorX",()=>(this.x=Math.floor(this.x),this)),(0,n.Z)(this,"floorY",()=>(this.y=Math.floor(this.y),this)),(0,n.Z)(this,"ceil",()=>(this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this)),(0,n.Z)(this,"ceilX",()=>(this.x=Math.ceil(this.x),this)),(0,n.Z)(this,"ceilY",()=>(this.y=Math.ceil(this.y),this)),(0,n.Z)(this,"trunc",()=>(this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this)),(0,n.Z)(this,"truncX",()=>(this.x=Math.trunc(this.x),this)),(0,n.Z)(this,"truncY",()=>(this.y=Math.trunc(this.y),this)),(0,n.Z)(this,"clone",()=>new this.constructor(this.x,this.y)),(0,n.Z)(this,"toArray",()=>[this.x,this.y]),(0,n.Z)(this,"toObject",()=>({x:this.x,y:this.y})),(0,n.Z)(this,"toString",(t="x",e="y")=>`${t}${this.x}${e}${this.y}`),this.set(...t)}get zero(){return new this.constructor(0,0)}get infinity(){return new this.constructor(1/0,1/0)}get NaN(){return new this.constructor(NaN,NaN)}get unit(){return new this.constructor(1,1)}get valid(){return this.__needUpdate&&(this.__valid=r()(this.x)&&r()(this.y),this.__needUpdate=!1),this.__valid}get area(){return this.x*this.y}}class a extends o{constructor(...t){super(...t)}}},14050:(t,e,i)=>{i.d(e,{i:()=>g});var n=i(26243),s=i.n(n),r=i(62680),o=i.n(r),a=i(95366),c=i.n(a),d=i(6919),u=i.n(d),h=i(93364),l=i.n(h),f=i(26771),p=i.n(f),m=i(33385);function v(t,e){var i=s()(t);if(o()){var n=o()(t);e&&(n=n.filter((function(e){return c()(t,e).enumerable}))),i.push.apply(i,n)}return i}function y(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?v(Object(i),!0).forEach((function(e){(0,m.Z)(t,e,i[e])})):u()?l()(t,u()(i)):v(Object(i)).forEach((function(e){p()(t,e,c()(i,e))}))}return t}class g{constructor(t,e,i,n,s){(0,m.Z)(this,"active",!1),(0,m.Z)(this,"runCallback",t=>{const e=this.onBeforeRunCallback(t);if(e&&this.active){const e=this.onRunCallBack(t);return this.onAfterCallback(e)}}),this.manager=t,this.name=e,this.data=i,this.callback=n,this.options=s}setDataMap(t){this.data=y(y({},this.data),t)}setData(t,e){this.data=y(y({},this.data),{},{[t]:e})}setCallback(t){this.callback=t}onBeforeRunCallback(...t){return!0}onRunCallBack(t){if(this.callback instanceof Function)return this.callback(t)}onAfterCallback(t){return t}async onBeforeLaunch(t){return t}async onLaunch(t){return t}async onAfterLaunch(t){return t}async launch(t){if(this.active)return!1;const e=await this.onBeforeLaunch(t),i=await this.onLaunch(e);return this.active=!0,await this.onAfterLaunch(i)}async onBeforePause(t){return t}async onPause(t){return t}async onAfterPause(t){return t}async pause(t){const e=await this.onBeforePause(t),i=await this.onPause(e);return this.active=!1,await this.onAfterPause(i)}async onBeforeClear(t){return t}async onClear(t){return t}async onAfterClear(t){return t}async clear(t){const e=await this.onBeforeClear(t),i=await this.onClear(e);return this.active=!1,await this.onAfterClear(i)}}},12611:(t,e,i)=>{i.d(e,{G:()=>b});var n=i(79529),s=i.n(n);let r={playResX:560,playResY:420,fontlist:["PingFang SC","Source Han Sans CN","Microsoft YaHei UI","Microsoft YaHei","\u6587\u6cc9\u9a7f\u6b63\u9ed1","STHeitiSC","\u9ed1\u4f53"],font_size:1,r2ltime:8,fixtime:4,opacity:.6,space:0,max_delay:6,bottom:50,use_canvas:null,debug:!1},o=r.debug?void 0:function(){},a=function(t){let e=Array.apply(Array,arguments);return t.replace(/{{([^}]+)}}/g,(function(t,i){let n;return e.some((function(t){return n=t[i]})),n||""}))},c=function(t){let e=Number(t).toString(16).toUpperCase();return e.length>6&&(e=e.substr(1)),Array(7-e.length).join("0")+e},d=function(t){let e=Math.round(255*(1-t)).toString(16).toUpperCase();return Array(3-e.length).join("0")+e},u=Math.hypot?Math.hypot.bind(Math):function(){return Math.sqrt([0].concat(Array.apply(Array,arguments)).reduce((function(t,e){return t+e*e})))},h=document.createElement("canvas"),l=h.getContext("2d"),f=function(){let t=function(){return function(t,e,i){return l.font="bold "+i+"px "+t,Math.ceil(l.measureText(e).width+r.space)}},e=function(){let t=document.createElement("div");t.setAttribute("style",["all: unset","top: -10000px","left: -10000px","width: auto","height: auto","position: absolute",""].join(" !important; "));let e=function(){document.body.parentNode.appendChild(t)};return document.body?e():document.addEventListener("DOMContentLoaded",e),function(e,i,n){return t.textContent=i,t.style.font="bold "+n+"px "+e,t.clientWidth+r.space}};return null===r.use_canvas&&navigator.platform.match(/linux/i)&&!navigator.userAgent.match(/chrome/i)&&(r.use_canvas=!1),o("use canvas: %o",!1!==r.use_canvas),!1===r.use_canvas?e():t()}(),p=function(t){let e="The quick brown fox jumps over the lazy dog7531902468,.!-\uff0c\u3002\uff1a\uff01\u5929\u5730\u7384\u9ec4\u5247\u8fd1\u9053\u77e3",i=["monospace","sans-serif","sans","Symbol","Arial","Comic Sans MS","Fixed","Terminal","Times","Times New Roman","\u5b8b\u4f53","\u9ed1\u4f53","\u6587\u6cc9\u9a7f\u6b63\u9ed1","Microsoft YaHei","PingFang SC"],n=function(t,i){let n=f(t,e,72),s=f(i+","+t,e,72);return n!==s},s=function(t){let e=i.some((function(e){return n(e,t)}));return o("font %s: %o",t,e),e},r=t[t.length-1];return t=t.filter(s),o("fontlist: %o",t),t[0]||r},m=function(){let t=!1;return function(){t||(t=!0,f=f.bind(window,r.font=p(r.fontlist)))}}(),v=function(t,e){let i=a("[Script Info]\nTitle: {{title}}\nOriginal Script: \u6839\u636e {{ori}} \u7684\u5f39\u5e55\u4fe1\u606f\uff0c\u7531 https://github.com/tiansh/us-danmaku \u751f\u6210\nScriptType: v4.00+\nCollisions: Normal\nPlayResX: {{playResX}}\nPlayResY: {{playResY}}\nTimer: 10.0000\n\n[V4+ Styles]\nFormat: Name, Fontname, Fontsize, PrimaryColour, SecondaryColour, OutlineColour, BackColour, Bold, Italic, Underline, StrikeOut, ScaleX, ScaleY, Spacing, Angle, BorderStyle, Outline, Shadow, Alignment, MarginL, MarginR, MarginV, Encoding\nStyle: Fix,{{font}},25,&H{{alpha}}FFFFFF,&H{{alpha}}FFFFFF,&H{{alpha}}000000,&H{{alpha}}000000,1,0,0,0,100,100,0,0,1,2,0,2,20,20,2,0\nStyle: R2L,{{font}},25,&H{{alpha}}FFFFFF,&H{{alpha}}FFFFFF,&H{{alpha}}000000,&H{{alpha}}000000,1,0,0,0,100,100,0,0,1,2,0,2,20,20,2,0\n\n[Events]\nFormat: Layer, Start, End, Style, Name, MarginL, MarginR, MarginV, Effect, Text\n",r,e,{alpha:d(r.opacity)}),n=function(t,e){t=""+t;while(t.length<e)t="0"+t;return t},o=function(t){t=100*t^0;let e=[[100,2],[60,2],[60,2],[1/0,0]].map((function(e){let i=t%e[0];return t=(t-i)/e[0],n(i,e[1])})).reverse();return e.slice(0,-1).join(":")+"."+e[3]},c=function(){let t=function(t){let e="",i=t.color.split(/(..)/).filter((function(t){return t})).map((function(t){return s()(t,16)}));"FFFFFF"!==t.color&&(e+="\\c&H"+t.color.split(/(..)/).reverse().join(""));let n=.299*i[0]+.587*i[1]+.114*i[2]<48;return n&&(e+="\\3c&HFFFFFF"),25!==t.size&&(e+="\\fs"+t.size),e},e=function(t){return"\\move("+[t.poss.x,t.poss.y,t.posd.x,t.posd.y].join(",")+")"},i=function(t){return"\\pos("+[t.poss.x,t.poss.y].join(",")+")"},n=function(e){return function(i){return e(i)+t(i)}};return{R2L:n(e),Fix:n(i)}}(),u=function(t){return t.replace(/{/g,"\uff5b").replace(/}/g,"\uff5d").replace(/\r|\n/g,"")},h=function(t){try{return"Dialogue: "+[0,o(t.stime),o(t.dtime),t.type,",20,20,2,,"].join(",")+"{"+c[t.type](t)+"}"+u(t.text)}catch(e){return""}};return i+t.map(h).filter(Boolean).filter((function(t){return t})).join("\n")},y=function(t,e,i,n,s){return function(){let r=[{p:-1/0,m:0,tf:1/0,td:1/0,b:!1},{p:e,m:1/0,tf:1/0,td:1/0,b:!1},{p:e-i,m:e,tf:1/0,td:1/0,b:!0}],o=function(t,i,n,o){let a=[];r.forEach((function(s){if(s.m>e)return;let c=s.m,d=c+t,u=i,h=n;r.forEach((function(t){t.p>=d||t.m<=c||t.b&&o||(u=Math.max(u,t.tf),h=Math.max(h,t.td))})),a.push({p:c,r:Math.max(u-i,h-n)})})),a.sort((function(t,e){return t.p-e.p}));let c=s;return a=a.filter((function(t){return!(t.r>=c)&&(c=t.r,!0)})),a},a=function(t,e,i,n){r.push({p:t,m:e,tf:i,td:n,b:!1})},c=function(t,e){r=r.filter((function(i){return i.tf>t||i.td>e}))},d=function(t){return t.r>s?-1/0:1-u(t.r/s,t.p/e)*Math.SQRT1_2};return function(e,i,s,r){let u=t/(i+t)*n+e;c(e,u);let h=o(s,e,u,r);if(!h.length)return null;let l=h.map((function(t){return[d(t),t]})),f=l.reduce((function(t,e){return t[0]>e[0]?t:e}))[1],p=e+f.r,m=i/(i+t)*n+p,v=n+p;return a(f.p,f.p+s,m,v),{top:f.p,time:p}}}}(r.playResX,r.playResY,r.bottom,r.r2ltime,r.max_delay),g=function(t,e,i,n){return function(){let s=[{p:-1/0,m:0,td:1/0,b:!1},{p:t,m:1/0,td:1/0,b:!1},{p:t-e,m:t,td:1/0,b:!0}],r=function(t,e,i,n){let r=i;return s.forEach((function(i){i.p>=e||i.m<=t||i.b&&n||(r=Math.max(r,i.td))})),{r:r-i,p:t,m:e}},o=function(e,i,n){let o=[];return s.forEach((function(s){s.m>t||o.push(r(s.m,s.m+e,i,n))})),o},a=function(t,e,i){let n=[];return s.forEach((function(s){s.p<0||n.push(r(s.p-t,s.p,e,i))})),n},c=function(t,e,i){s.push({p:t,m:e,td:i,b:!1})},d=function(t){s.length>=1e3&&(s=s.slice(-500)),s=s.filter((function(e){return e.td>t}))},u=function(e,i){if(e.r>n)return-1/0;let s=function(e){return i?e:t-e};return 1-(e.r/n*(31/32)+s(e.p)/t*(1/32))};return function(t,e,n,s){d(t);let r=(n?o:a)(e,t,s);if(!r.length)return null;let h=r.map((function(t){return[u(t,n),t]})),l=h.reduce((function(t,e){return t[0]>e[0]?t:e}))[1];return c(l.p,l.m,l.r+t+i),{top:l.p,time:l.r+t}}}}(r.playResY,r.bottom,r.fixtime,r.max_delay),_=function(t){let e=y(),i=g();t.length;return t.sort((function(t,e){return t.time-e.time})).map((function(t,n){try{let n=Math.round(t.size*r.font_size),s=f(t.text,n);switch(t.mode){case"R2L":{let i=e(t.time,s,n,t.bottom);return i?(t.type="R2L",t.stime=i.time,t.poss={x:r.playResX+s/2,y:i.top+n},t.posd={x:-s/2,y:i.top+n},t.dtime=r.r2ltime+t.stime,t):null}case"TOP":case"BOTTOM":{const e="TOP"===t.mode;let s=i(t.time,n,e,t.bottom);return s?(t.type="Fix",t.stime=s.time,t.posd=t.poss={x:Math.round(r.playResX/2),y:s.top+n},t.dtime=r.fixtime+t.stime,t):null}default:return null}}catch(s){}})).filter((function(t){return t})).sort((function(t,e){return t.stime-e.stime}))},I=function(t){return t.map(t=>{let{danmu:e,progress:i,mode:n,fontsize:s,color:r,weight:o}=t;return n=[void 0,"R2L","R2L","R2L","BOTTOM","TOP"][n],r=c(r),{text:e,time:(i||0)/1e3,mode:n,size:s,color:r,bottom:o>0}})};async function b(t,e){return v(_(I(t)),e)}m()},16203:(t,e,i)=>{i.d(e,{MessageStore:()=>o.$});var n=i(94604);i.o(n,"Feature")&&i.d(e,{Feature:function(){return n.Feature}}),i.o(n,"MessageStore")&&i.d(e,{MessageStore:function(){return n.MessageStore}});var s=i(93417);i.o(s,"Feature")&&i.d(e,{Feature:function(){return s.Feature}}),i.o(s,"MessageStore")&&i.d(e,{MessageStore:function(){return s.MessageStore}});var r=i(69759);i.o(r,"Feature")&&i.d(e,{Feature:function(){return r.Feature}}),i.o(r,"MessageStore")&&i.d(e,{MessageStore:function(){return r.MessageStore}});var o=i(25240),a=i(79966);i.o(a,"Feature")&&i.d(e,{Feature:function(){return a.Feature}});i(53709)},25240:(t,e,i)=>{i.d(e,{$:()=>o});var n=i(33385),s=i(73473),r=i.n(s);class o{constructor(t){(0,n.Z)(this,"selfId",void 0),(0,n.Z)(this,"addListener",()=>{chrome.runtime.onMessage.addListener((t,e)=>{const i=e.tab&&e.tab.id||e.id;if(this.selfId=i,t.command===this.initializedName){let t=this.createData(i);0===t.state&&(t.state=1),this.dealWith(i)}return!0}),chrome.tabs.onRemoved.addListener((t,e)=>{this.has(t)&&e.isWindowClosing&&this.delete(t)}),chrome.tabs.onUpdated.addListener((t,e)=>{const{status:i,url:n}=e;this.has(t)&&"loading"===i&&void 0===n?this.delete(t):this.has(t)&&"complete"===i&&this.createData(t)})}),(0,n.Z)(this,"createData",t=>this.has(t)?this.store[t]:this.store[t]={state:0,queue:[],data:{id:t}}),(0,n.Z)(this,"has",t=>!!this.store[t]),(0,n.Z)(this,"get",t=>this.store[t]),(0,n.Z)(this,"delete",t=>delete this.store[t]),(0,n.Z)(this,"dealWith",t=>{const e=(t,e)=>e?new(r())((i,n)=>{chrome.tabs.sendMessage(t,e,s=>{void 0!==s?i():n(`No result from tab[${t}] - command[${e.command}]`)})}):r().resolve();if(!1===this.has(t))return;const{state:i,queue:n}=this.store[t];i&&n.length>0&&e(t,n.shift()).then(()=>{n.length>0&&this.dealWith(t)},t=>{})}),this.store={},this.initializedName=t,this.addListener()}}},19607:(t,e,i)=>{i.d(e,{X:()=>w});var n=i(47874),s=i(33385),r=i(68630),o=i.n(r),a=i(43562),c=i.n(a),d=i(26243),u=i.n(d),h=i(62680),l=i.n(h),f=i(95366),p=i.n(f),m=i(6919),v=i.n(m),y=i(93364),g=i.n(y),_=i(26771),I=i.n(_),b=i(48903);const S={0:{dynamicInfo:{dynamicId:"desc.dynamic_id",dynamicIdStr:"desc.dynamic_id_str",type:"desc.type",timestamp:"desc.timestamp",content:"card.item.description",pictures:"card.item.pictures"},userInfo:{uid:"desc.uid",face:"desc.user_profile.info.face",name:"desc.user_profile.info.uname",sign:"desc.user_profile.sign",level:"desc.user_profile.level_info.current_level",vipInfo:{role:"desc.user_profile.vip.role",status:"desc.user_profile.vip.vipStatus"}}},1:{dynamicInfo:{dynamicId:"desc.dynamic_id",dynamicIdStr:"desc.dynamic_id_str",type:"desc.type",timestamp:"desc.timestamp",content:"card.item.content"},userInfo:{uid:"desc.uid",face:"desc.user_profile.info.face",name:"desc.user_profile.info.uname",sign:"desc.user_profile.sign",level:"desc.user_profile.level_info.current_level",vipInfo:{role:"desc.user_profile.vip.role",status:"desc.user_profile.vip.vipStatus"}},originInfo:{dynamicId:"desc.orig_dy_id",dynamicIdStr:"desc.orig_dy_id_str",type:"desc.orig_type",uid:"desc.origin.uid",content:"card.origin.item.description",pictures:"card.origin.item.pictures",userInfo:{name:"card.origin_user.info.uname",uid:"card.origin_user.info.uid",face:"card.origin_user.info.face",vipInfo:{role:"card.origin_user.vip.role",status:"card.origin_user.vip.vipStatus"}}},roomInfo:{title:"card.title",roomId:"card.roomid"},originVideoInfo:{aid:"card.origin.aid",cid:"card.origin.cid",bvid:"desc.origin.bvid",title:"card.origin.title",description:"card.origin.desc",cover:"card.origin.pic",firstFrame:"card.origin.first_frame",url:"card.origin.jump_url",shortLink:"card.origin.short_link",publishDate:"card.origin.pubdate",duration:"card.origin.duration"},seasonInfo:{title:"card.origin.apiSeasonInfo.title",cover:"card.origin.apiSeasonInfo.cover",seasonId:"card.origin.apiSeasonInfo.season_id",typeName:"card.origin.apiSeasonInfo.type_name",isFinish:"card.origin.apiSeasonInfo.is_finish"}},2:{dynamicInfo:{dynamicId:"desc.dynamic_id",dynamicIdStr:"desc.dynamic_id_str",type:"desc.type",timestamp:"desc.timestamp",content:"card.item.description",pictures:"card.item.pictures"},userInfo:{uid:"desc.uid",face:"desc.user_profile.info.face",name:"desc.user_profile.info.uname",sign:"desc.user_profile.sign",level:"desc.user_profile.level_info.current_level",vipInfo:{role:"desc.user_profile.vip.role",status:"desc.user_profile.vip.vipStatus"}}},4:{dynamicInfo:{dynamicId:"desc.dynamic_id",dynamicIdStr:"desc.dynamic_id_str",type:"desc.type",timestamp:"desc.timestamp",content:"card.item.content"},userInfo:{uid:"desc.uid",face:"desc.user_profile.info.face",name:"desc.user_profile.info.uname",sign:"desc.user_profile.sign",level:"desc.user_profile.level_info.current_level",vipInfo:{role:"desc.user_profile.vip.role",status:"desc.user_profile.vip.vipStatus"}}},8:{dynamicInfo:{dynamicId:"desc.dynamic_id",dynamicIdStr:"desc.dynamic_id_str",type:"desc.type",timestamp:"desc.timestamp"},userInfo:{uid:"desc.uid",face:"desc.user_profile.info.face",name:"desc.user_profile.info.uname",sign:"desc.user_profile.sign",level:"desc.user_profile.level_info.current_level",vipInfo:{role:"desc.user_profile.vip.role",status:"desc.user_profile.vip.vipStatus"}},videoInfo:{aid:"card.aid",cid:"card.cid",bvid:"desc.bvid",title:"card.title",description:"card.dynamic",cover:"card.pic",firstFrame:"card.first_frame",url:"card.jump_url",shortLink:"card.short_link",publishDate:"card.pubdate",duration:"card.duration",tagName:"card.tname"}},64:{dynamicInfo:{dynamicId:"desc.dynamic_id",dynamicIdStr:"desc.dynamic_id_str",type:"desc.type",timestamp:"desc.timestamp"},userInfo:{uid:"desc.uid",face:"desc.user_profile.info.face",name:"desc.user_profile.info.uname",sign:"desc.user_profile.sign",level:"desc.user_profile.level_info.current_level",vipInfo:{role:"desc.user_profile.vip.role",status:"desc.user_profile.vip.vipStatus"}},articleInfo:{id:"card.id",title:"card.title",summary:"card.summary",url:"card.url",publishDate:"card.publish_time",index:"card.index",category:"card.category",cover:"card.image_urls.0",banner:"card.banner_url"}},256:{dynamicInfo:{dynamicId:"desc.dynamic_id",dynamicIdStr:"desc.dynamic_id_str",type:"desc.type",timestamp:"desc.timestamp"},userInfo:{uid:"desc.uid",face:"desc.user_profile.info.face",name:"desc.user_profile.info.uname",sign:"desc.user_profile.sign",level:"desc.user_profile.level_info.current_level",vipInfo:{role:"desc.user_profile.vip.role",status:"desc.user_profile.vip.vipStatus"}},musicInfo:{id:"card.id",title:"card.title",description:"crad.intro",schema:"card.schema",publishDate:"card.ctime",index:"card.index"}},512:{dynamicInfo:{dynamicId:"desc.dynamic_id",dynamicIdStr:"desc.dynamic_id_str",type:"desc.type",timestamp:"desc.timestamp"},userInfo:{uid:"desc.uid",face:"card.apiSeasonInfo.cover",name:"card.apiSeasonInfo.title"},videoInfo:{aid:"card.aid",episodeId:"card.episode_id",title:"card.index_title",cover:"card.apiSeasonInfo.cover",url:"card.url",publishDate:"desc.timestamp",index:"card.index"},seasonInfo:{title:"card.apiSeasonInfo.title",cover:"card.apiSeasonInfo.cover",seasonId:"card.apiSeasonInfo.season_id",typeName:"card.apiSeasonInfo.type_name",isFinish:"card.apiSeasonInfo.is_finish"}}},L=["card","desc","display","extend_json"];function E(t,e){var i=u()(t);if(l()){var n=l()(t);e&&(n=n.filter((function(e){return p()(t,e).enumerable}))),i.push.apply(i,n)}return i}function M(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?E(Object(i),!0).forEach((function(e){(0,s.Z)(t,e,i[e])})):v()?g()(t,v()(i)):E(Object(i)).forEach((function(e){I()(t,e,p()(i,e))}))}return t}class w{constructor(t){(0,s.Z)(this,"dynamicInfo",void 0),(0,s.Z)(this,"userInfo",void 0),(0,s.Z)(this,"videoInfo",void 0),(0,s.Z)(this,"articleInfo",void 0),(0,s.Z)(this,"musicInfo",void 0),(0,s.Z)(this,"seasonInfo",void 0),(0,s.Z)(this,"finishing",()=>{this.data.dynamicInfo&&this.data.dynamicInfo.timestamp&&(this.data.dynamicInfo.timestamp=(0,b.videoPublishDescription)(1e3*this.data.dynamicInfo.timestamp)),this.data.dynamicInfo&&this.data.dynamicInfo.content&&(this.data.dynamicInfo.parsedContent=this.parseDescription(this.data.dynamicInfo.content)),this.data.videoInfo&&this.data.videoInfo.duration&&(this.data.videoInfo.duration=(0,b.parseTime)(1e3*this.data.videoInfo.duration)),this.data.videoInfo&&this.data.videoInfo.publishDate&&(this.data.videoInfo.publishDate=(0,b.videoPublishDescription)(1e3*this.data.videoInfo.publishDate)),this.data.videoInfo&&this.data.videoInfo.description&&(this.data.videoInfo.description=this.parseDescription(this.data.videoInfo.description)),this.data.videoInfo&&this.data.videoInfo.url&&(this.data.videoInfo.url=this.data.videoInfo.url.replace("bilibili://video/","https://www.bilibili.com/video/av").replace("http://","https://")),this.data.videoInfo&&this.data.videoInfo.url&&this.data.videoInfo.url.includes("bilibili://"),this.data.musicInfo&&this.data.musicInfo.publishDate&&(this.data.musicInfo.publishDate=(0,b.videoPublishDescription)(this.data.musicInfo.publishDate)),this.data.articleInfo&&this.data.articleInfo.publishDate&&(this.data.articleInfo.publishDate=(0,b.videoPublishDescription)(1e3*this.data.articleInfo.publishDate)),this.data.originInfo&&this.data.originInfo.content&&(this.data.originInfo.content=this.parseDescription(this.data.originInfo.content)),this.data.originVideoInfo&&this.data.originVideoInfo.url&&(this.data.originVideoInfo.url=this.data.originVideoInfo.url.replace("bilibili://video/","https://www.bilibili.com/video/av").replace("http://","https://"))}),(0,s.Z)(this,"parseEmoji",(t="")=>{const e=new RegExp(/(\[.*?\])/g),i=[];let n=null,s=0;while(null!==(n=e.exec(t))){var r;const{index:e}=n,o=n[0];i.push(t.substr(s,e-s)),s=e+o.length;const a=null===(r=window.emojis)||void 0===r?void 0:r.get(o);a&&i.push(`<img class="bilibili-emoji" src="${a}"/>`)}return t.substr(s)&&i.push(t.substr(s)),0===i.length&&i.push(t),i.join("")}),(0,s.Z)(this,"parseDescription",(t="")=>(t=t.replace(/((https?:\/\/)|(www\.))(?:\S+)/gi,t=>`<a class="bilibili-link" target="_blank" href="${t}">\u7f51\u9875\u94fe\u63a5</a>`),t=this.parseEmoji(t),t=t.replace(/#(.+?)#/gi,t=>`<a class="bilibili-topic-link" target="_blank" href="${encodeURI(`https://t.bilibili.com/topic/name/${t.slice(1,-1)}/feed`)}">${t}</a>`),t.trim())),(0,s.Z)(this,"readParam",(t,e)=>{if(!t)return null;if("string"===typeof e){const i=e.split(".");let n;for(let e=0;e<i.length;++e)if(n=(n||t)[i[e]],void 0===n)return null;return n}if(o()(e)){let i=0;const n=c()(e);return n.reduce((e,[s,r])=>{const o=this.readParam(t,r);return null===o||void 0===o?++i:e[s]=o,n.length===i?null:e},{})}});try{this.init(t)}catch(e){}}get notificationObject(){return{}}init(t){let{card:e,desc:i,display:s,extend_json:r}=t,o=(0,n.Z)(t,L);e=this.parse(e),e.origin&&(e.origin=this.parse(e.origin)),e.origin_extend_json&&(e.origin_extend_json=this.parse(e.origin_extend_json));const a=this.parse(r),c=M({card:e,desc:i,display:s,extend:a},o),d=S[i.type]||S[0];this.data=this.readParam(c,d),this.data.originData=c,this.finishing()}parse(t){try{return JSON.parse(t)}catch(e){}}toJSON(){return M({type:this.data.dynamicInfo.type},this.data)}}},32559:(t,e,i)=>{var n=i(26243),s=i.n(n),r=i(62680),o=i.n(r),a=i(95366),c=i.n(a),d=i(6919),u=i.n(d),h=i(93364),l=i.n(h),f=i(26771),p=i.n(f),m=i(33385),v=i(73473),y=i.n(v),g=i(72406),_=i(47121),I=i(42254),b=i(33718),S=i(89865),L=i(48903);i(58971);const E=JSON.parse('["en","zh_CN","zh_TW"]');function M(t,e){var i=s()(t);if(o()){var n=o()(t);e&&(n=n.filter((function(e){return c()(t,e).enumerable}))),i.push.apply(i,n)}return i}function w(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?M(Object(i),!0).forEach((function(e){(0,m.Z)(t,e,i[e])})):u()?l()(t,u()(i)):M(Object(i)).forEach((function(e){p()(t,e,c()(i,e))}))}return t}window.addEventListener("unhandledrejection",t=>{}),window.addEventListener("error",(function(t){})),chrome.contextMenus.removeAll();let A=!1,O=!1;chrome.runtime.onInstalled.addListener((function(t){const{reason:e,previousVersion:i}=t;"install"===e&&(A=!0),["install","update"].includes(e)&&(O=!0)})),chrome.i18n.getAcceptLanguages(t=>{const e=E||[],i=e.map(t=>`../_locales/${t}/messages.json`),n=i.map((t,i)=>fetch(t).then(async t=>({[e[i].replace("_","-")]:await t.json()})));y().all(n).then(e=>{const i=e.reduce((t,e)=>w(w({},t),e),{});window.i18nMap=t.reduce((t,e)=>(/^zh/.test(e)&&"zh-TW"!==e?t["zh-CN"]||(t["zh-CN"]=i["zh-CN"]):i[e]||(t[e]=i["zh-CN"]),t),i)})});const C=new S.g;window.app=C,C.onLaunch=async()=>{g&&await C.loadItems(g),_&&await C.loadItems(_),I&&await C.loadItems(I),b&&await C.loadItems(b),await C.emit("*","allHasLoaded",{firstInstall:A,updated:O}),A&&(0,L.createTabByURL)((0,L.getURL)("html/config.html"))},C.init().then(async()=>{await C.emit("app","setInitialStatus",{name:"initializedAll",value:!0})}).catch(t=>{})},16814:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0})},13429:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0})},10804:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0})},37873:function(t,e,i){var n=this&&this.__createBinding||(Object.create?function(t,e,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(e,i);s&&!("get"in s?!e.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,n,s)}:function(t,e,i,n){void 0===n&&(n=i),t[n]=e[i]}),s=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||n(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),s(i(10804),e),s(i(16814),e),s(i(13429),e)},25911:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.APP_PERMISSION_ERRORS=e.appErrorFactory=void 0;const n=i(80172);e.appErrorFactory=new n.ItemErrorFactory("app"),e.APP_PERMISSION_ERRORS={INVALID_ITEM_NAME:e.appErrorFactory.create("invalidItemName"),UNDEFINED_ITEM:e.appErrorFactory.create("undefinedItem"),INVALID_SETTINGS:e.appErrorFactory.create("invalidSettings")}},72912:(t,e)=>{},79966:function(t,e,i){var n=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Cache=void 0;const s=i(96486),r=n(i(58971)),o=i(96486);class a{constructor(t,{type:e,dataType:i,limit:n,delayDuration:c=2e3,initFunc:d}){if(this.config={limit:{size:void 0,duration:void 0}},this.delayDuration=1e3,this.init=t=>{null===t&&void 0===t||this.set(t)},this.set=(t,e=!1)=>{var i,n;e&&this.clearCache(!0),void 0!==t&&(this.store=t,(null===(n=null===(i=this.config)||void 0===i?void 0:i.limit)||void 0===n?void 0:n.duration)&&(this.config.limit.t=Date.now(),r.default.set(this.configName,this.config))),this.isLocalCache&&!this.delayTimer&&(clearTimeout(this.delayTimer),this.delayDuration?this.delayTimer=setTimeout(()=>{r.default.set(this.name,this.store),this.delayTimer=void 0},this.delayDuration):(r.default.set(this.name,this.store),this.delayTimer=void 0))},this.checkExpired=()=>{let t=!1,e=void 0;const{size:i,duration:n,t:r}=this.config.limit;return void 0===(i||n||r)&&(t=!0),this.store instanceof Array&&(e="array",i&&this.store.length>i&&(t=!0)),this.store instanceof Set&&(e="set",i&&this.store.size>i&&(t=!0)),this.store instanceof Map&&(e="map",i&&this.store.size>i&&(t=!0)),(0,s.isPlainObject)(this.store)&&(e="object",i&&Object.keys(this.store).length>i&&(t=!0)),void 0===e&&(e=typeof this.store),n&&Date.now()-r>n&&(t=!0),{type:e,expired:t}},this.clearCache=(t=!1)=>{const{type:e,expired:i}=this.checkExpired();if(i||t)switch(e){case"array":this.store.length=0;break;case"set":this.store.clear();break;case"map":this.store.clear();break;case"object":this.store={};break;case"string":this.store="";break;case"number":this.store=0;break;case"boolean":this.store=!1;break;default:this.store=void 0}},this.remove=()=>{r.default.remove(this.name),r.default.remove(this.configName)},this.get=(t=!0)=>(!t&&this.clearCache(),this.store),!t)throw"invalid owner";this.owner=t,this.dataType=i,this.initFunc=d||a.__dataInitFunc,this.name=t.names.item+"-cache",this.configName=this.name+"-config",this.isLocalCache="local"===e;const u=r.default.get(this.configName);if(void 0===u?r.default.set(this.configName,this.config):this.config=u,(0,o.isEmpty)(n)&&(this.expired=!0),null===n||void 0===n?void 0:n.size){if(isNaN(n.size))throw"invalid limit size";this.config.limit.size=+n.size}if(null===n||void 0===n?void 0:n.duration){if(isNaN(n.duration))throw"invalid limit duration";this.config.limit.duration=+n.duration}if(r.default.set(this.configName,this.config),this.isLocalCache){let t=r.default.get(this.name);this.store=this.initFunc(this.dataType,r.default.get(this.name))||this.initFunc(this.dataType),t||this.set(this.store,!1)}else r.default.remove(this.name),this.dataType&&(this.store=this.initFunc(this.dataType),this.set(this.store,!1));void 0!==c&&(this.delayDuration=c)}}e.Cache=a,a.__dataInitFunc=(t,e)=>{if(e){if(["number","boolean","string","array","object"].includes(t))return e;switch(t){case"set":return new Set(e);case"map":return new Map(e);default:return e}}else switch(t){case"number":return 0;case"boolean":return!1;case"string":return"";case"array":return[];case"set":return new Set;case"map":return new Map;case"object":return{};default:return}}},93417:function(t,e,i){var n=this&&this.__awaiter||function(t,e,i,n){function s(t){return t instanceof i?t:new i((function(e){e(t)}))}return new(i||(i=Promise))((function(i,r){function o(t){try{c(n.next(t))}catch(e){r(e)}}function a(t){try{c(n["throw"](t))}catch(e){r(e)}}function c(t){t.done?i(t.value):s(t.value).then(o,a)}c((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.Controller=void 0;const s=i(94604);class r extends s.Item{constructor(t,e,i){super(t,e,i),this.__itemType="controller",this.tasks=[]}addTask(t,e){this.tasks.push({task:t,sendResponse:e})}dealWithTaskList(t=!1){return n(this,void 0,void 0,(function*(){const e=yield this.onBeforeDealWithTaskList();t?void 0!==e&&(yield this.onDealWithTaskList(),yield this.onAfterDealWithTaskList()):(yield this.onDealWithTaskList(),yield this.onAfterDealWithTaskList())}))}onBeforeDealWithTaskList(){return n(this,void 0,void 0,(function*(){}))}onDealWithTaskList(){return n(this,void 0,void 0,(function*(){}))}onAfterDealWithTaskList(){return n(this,void 0,void 0,(function*(){}))}dealWithTask(t){return n(this,void 0,void 0,(function*(){yield this.onBeforeDealWithTask(t);const e=yield this.onDealWithTask(t);return yield this.onAfterDealWithTask(t),e}))}onBeforeDealWithTask(t){return n(this,void 0,void 0,(function*(){}))}onDealWithTask(t){return n(this,void 0,void 0,(function*(){}))}onAfterDealWithTask(t){return n(this,void 0,void 0,(function*(){}))}}e.Controller=r},69759:function(t,e,i){var n=this&&this.__awaiter||function(t,e,i,n){function s(t){return t instanceof i?t:new i((function(e){e(t)}))}return new(i||(i=Promise))((function(i,r){function o(t){try{c(n.next(t))}catch(e){r(e)}}function a(t){try{c(n["throw"](t))}catch(e){r(e)}}function c(t){t.done?i(t.value):s(t.value).then(o,a)}c((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.Feature=void 0;const s=i(94604),r=i(49675);class o extends s.Item{constructor(t,e,i){super(t,e,i),this.__itemType="feature",this.hasLogin=!1,this.bhAccount=null,this.bilibiliAccount=null,this.isVIP=!1,this.isSuperVIP=!1}initDefaultListener(){const t=Object.create(null,{initDefaultListener:{get:()=>super.initDefaultListener}});return n(this,void 0,void 0,(function*(){yield t.initDefaultListener.call(this),this.addListener("accountChanged",(t,e,i)=>{if(!t)return;const{hasLogin:n,bhAccount:s,bilibiliAccount:o}=t;this.hasLogin=n,this.bhAccount=s,this.isVIP=(0,r.isVIP)(this.bhAccount),this.isSuperVIP=(0,r.isSuperVIP)(this.bhAccount),this.bilibiliAccount=o,this.onBHAccountChange(this.bhAccount),i instanceof Function&&i()}),yield this.emit("bilibiliHelperAccountController","getStatus",null,t=>{if(!t)return;const{hasLogin:e,bhAccount:i,bilibiliAccount:n}=t;this.hasLogin=e,this.bhAccount=i,this.isVIP=(0,r.isVIP)(this.bhAccount),this.isSuperVIP=(0,r.isSuperVIP)(this.bhAccount),this.onBHAccountChange(this.bhAccount),this.bilibiliAccount=n})}))}onBHAccountChange(t){return n(this,void 0,void 0,(function*(){}))}}e.Feature=o},94604:function(t,e,i){var n=this&&this.__awaiter||function(t,e,i,n){function s(t){return t instanceof i?t:new i((function(e){e(t)}))}return new(i||(i=Promise))((function(i,r){function o(t){try{c(n.next(t))}catch(e){r(e)}}function a(t){try{c(n["throw"](t))}catch(e){r(e)}}function c(t){t.done?i(t.value):s(t.value).then(o,a)}c((n=n.apply(t,e||[])).next())}))},s=this&&this.__rest||function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(t,n[s])&&(i[n[s]]=t[n[s]])}return i},r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Item=e.SIMPLIFY_FILTER_LIST=void 0;const o=i(96486),a=r(i(17187)),c=r(i(58971)),d=i(79966),u=i(53709),h=i(25911);e.SIMPLIFY_FILTER_LIST=["description","title","permissions","dependencies","type","kind","name","hide"];class l{constructor(t,e,i){if(this.__itemType="item",this.__storeNames=[],this.__hasInstantiated=!1,this.__initialized=!1,this.__firstLaunched=!1,this.__launched=!1,this.emitter=new a.default,this.requireLoadList=new Set,this.rename=(t,e=!1)=>{if(!t)throw"Need new name in config";const i=this.name;this.logger=new u.Logger(t),this.names={item:t,config:t+"-config",data:t+"-data",storeNames:t+"-store-names"},l.loadedItems.set(t,this),l.loadedItems.delete(i),e&&this.cleanStore()},this.emit=(t,e,i,s=null,r=this)=>n(this,void 0,void 0,(function*(){try{if("*"===t){const t=Array.from(l.loadedItems.values()).map(t=>{var n,o;if(null===(o=null===(n=null===t||void 0===t?void 0:t.emitter)||void 0===n?void 0:n.eventNames())||void 0===o?void 0:o.includes(e))return new Promise(n=>{null===t||void 0===t||t.emitter.emit(e,i,r,n)}).then(t=>s?s(t):t)}).filter(Boolean);return t.length>0?Promise.race(t):null}{let n=l.queryItemByName(this,t);if(n)return yield new Promise(s=>{n.emitter.eventNames().includes(e)?n.emitter.emit(e,i,r,s):this.logger.warn(`none eventName in ${t}: `,e)}).then(t=>s?s(t):t).catch(t=>{});this.logger.warn("none item names: ",t),s&&s(!1)}}catch(n){}})),this.getStore=(t="default")=>{const e=[this.names.data,t].join("_");return c.default.get(e)},this.setStore=(t="default",e)=>{const i=[this.names.data,t].join("_");c.default.set(i,e);const n=this.storeNames;return n.push(i),this.storeNames=n,this},this.cleanStore=()=>{this.storeNames&&this.storeNames.length>0&&this.storeNames.forEach(t=>{c.default.remove(t)}),this.cache&&this.cache.remove(),c.default.remove(this.names.storeNames)},this.getStorage=(...t)=>new Promise(e=>{chrome.storage.local.get([...t],(function(t){e(t)}))}),this.setStorage=t=>new Promise((e,i)=>{chrome.storage.local.set(t,(function(){chrome.runtime.lastError?i(!1):e(!0)}))}),this.getStoreByCompleteName=t=>c.default.get(t),this.setStoreByCompleteName=(t,e)=>c.default.set(t,e),this.deleteStoreByCompleteName=t=>{c.default.remove(t)},this.setSettingsFromCloud=t=>n(this,void 0,void 0,(function*(){yield this.onBeforeSetSettingsFromCloud(t),yield this.onSetSettingsFromCloud(t),yield this.onAfterSetSettingsFromCloud(t)})),!e)throw"Need name in config";if(l.loadedItems.has(e))throw"existed data controller: "+e;const{cache:r,dependencies:o,settings:h={on:!0},launchAfterInit:f=!0,defaultListener:p=!0}=i||{settings:{on:!0},launchAfterInit:!0,defaultListener:!0};h&&void 0===h.on&&(h.on=!0),this.app=t,this.launchAfterInit=f,this.defaultListener=p,this.settings=Object.assign({},h);try{this.logger=new u.Logger(e),this.names={item:e,config:e+"-config",data:e+"-data",storeNames:e+"-store-names"},this.dependencies=o||[],this.__initSetting(h),this.__hasInstantiated=!0}catch(m){this.logger.error(m)}if(r){const{type:t,limit:e,delayDuration:i}=r,n=s(r,["type","limit","delayDuration"]);this.cache=new d.Cache(this,Object.assign({type:t,limit:e,delayDuration:i},n))}}get name(){return this.names.item}get storeNames(){if(this.__storeNames&&this.__storeNames.length>0)return this.__storeNames;{const t=c.default.get(this.names.storeNames)||[];t&&t.length>0&&(this.__storeNames=t.map(t=>this.name+"-"+t))}return this.__storeNames&&0!==this.__storeNames.length||(this.__storeNames=[this.names.config,this.names.data,this.names.storeNames]),this.__storeNames}set storeNames(t){this.__storeNames=[...t];const e=t.map(t=>t.replace(this.name+"-",""));c.default.set(this.names.storeNames,[...new Set(e)])}__initSetting(t){void 0===t&&(t={on:!0});const e=c.default.get(this.names.config),i=l.mergeConfig(t,e);this.settings=l.mergeConfig(this.settings,i),c.default.set(this.names.config,this.simplifyConfig(this.settings))}onBeforeInit(){return n(this,void 0,void 0,(function*(){}))}onInitStore(){return n(this,void 0,void 0,(function*(){}))}onInit(){return n(this,void 0,void 0,(function*(){}))}onAfterInit(){return n(this,void 0,void 0,(function*(){}))}init(){return n(this,void 0,void 0,(function*(){yield this.onBeforeInit(),yield this.onInit(),yield this.onInitStore(),yield this.onAfterInit(),this.__initialized=!0,l.loadedItems.set(this.name,this),this.defaultListener&&(yield this.initDefaultListener()),this.launchAfterInit&&(yield this.launch())}))}initDefaultListener(){return n(this,void 0,void 0,(function*(){this.addListener("message",this.onMessageReceived),this.addListener("getSettingsForUpload",this.getSettingsForUpload),this.addListener("setSetting",(t,e,i)=>{let{merge:n=!0}=t,r=s(t,["merge"]);n&&(r=Object.assign(Object.assign({},this.settings),r)),this.setSetting(r).then(()=>{i(!0)})}),this.addListener("getSetting",(t,e,i)=>{i(Object.assign({},this.settings))})}))}onBeforeSetSetting(t){return n(this,void 0,void 0,(function*(){}))}onSetSetting(t){return n(this,void 0,void 0,(function*(){this.settings=l.mergeConfig(this.settings,t),c.default.set(this.names.config,this.simplifyConfig(this.settings))}))}onAfterSetSetting(t,e){return n(this,void 0,void 0,(function*(){}))}setSetting(t){return n(this,void 0,void 0,(function*(){const e=JSON.parse(JSON.stringify(this.settings)),i=yield this.onBeforeSetSetting(t);yield this.onSetSetting(i||t),yield this.onAfterSetSetting(e,i||t)}))}getSetting(){return n(this,void 0,void 0,(function*(){return this.settings}))}onBeforeLaunch(){return n(this,void 0,void 0,(function*(){}))}onLaunch(){return n(this,void 0,void 0,(function*(){}))}onAfterLaunch(){return n(this,void 0,void 0,(function*(){}))}launch(){return n(this,void 0,void 0,(function*(){this.__launched||(yield this.onBeforeLaunch(),yield this.onLaunch(),yield this.onAfterLaunch(),this.__firstLaunched||(this.__firstLaunched=!0),this.__launched=!0)}))}onBeforePause(){return n(this,void 0,void 0,(function*(){}))}onPause(){return n(this,void 0,void 0,(function*(){}))}onAfterPause(){return n(this,void 0,void 0,(function*(){}))}pause(){return n(this,void 0,void 0,(function*(){yield this.onBeforePause(),yield this.onPause(),yield this.onAfterPause(),this.__launched=!1}))}onUninstall(){return n(this,void 0,void 0,(function*(){this.requireLoadList=new Set}))}uninstall(){return n(this,void 0,void 0,(function*(){yield this.onUninstall(),this.__initialized=!1,this.__launched=!1,this.emitter=new a.default,l.loadedItems.delete(this.name)}))}loadItems(t,e=null){return n(this,void 0,void 0,(function*(){(null===e||void 0===e?void 0:e.onBeforeItemLoad)&&(this.onBeforeLoad=e.onBeforeItemLoad),(null===e||void 0===e?void 0:e.onAfterItemLoad)&&(this.onAfterLoad=e.onAfterItemLoad),yield this.onBeforeLoad(t),yield this.onLoad(t),yield this.onAfterLoad()}))}onBeforeLoad(t){return n(this,void 0,void 0,(function*(){this.loadRetryMax=Object.keys(t).length,this.loadRetryTimes=0}))}onLoad(t){return n(this,void 0,void 0,(function*(){const e=yield this.__instantiateItems(t);yield this.__loadItems(e)}))}onAfterLoad(){return n(this,void 0,void 0,(function*(){this.loadRetryMax=0,this.loadRetryTimes=0}))}__instantiateItems(t){return n(this,void 0,void 0,(function*(){return new Promise(e=>{let i=new Map;Object.keys(t).forEach(e=>{const n=t[e];if(n&&n.prototype&&n.prototype.constructor.prototype instanceof l){const t=(0,o.lowerFirst)(e);i.has(t)||(n?i.set(t,new n(this,t)):this.logger.warn(h.APP_PERMISSION_ERRORS.UNDEFINED_ITEM,e))}}),e(i)})}))}__loadItems(t){return n(this,void 0,void 0,(function*(){this.loadQueue=Array.from(t.values()),this.loadQueue.length>0&&(yield this.dealWidthWaitQueue())}))}dealWidthWaitQueue(t=!1){return n(this,void 0,void 0,(function*(){if(t&&++this.loadRetryTimes,0===this.loadQueue.length)return!1;const e=this.loadQueue.shift();yield new Promise(i=>{this.checkDependencies(e)?(t&&--this.loadRetryTimes,i(this.__loadItem(e))):(this.loadQueue.push(e),i(!1))}).then(()=>{if(this.loadQueue.length>0&&this.loadRetryTimes<=this.loadRetryMax)return this.dealWidthWaitQueue(!0)})}))}__loadItem(t){return n(this,void 0,void 0,(function*(){yield this.onBeforeItemLoad(t),yield this.onItemLoad(t),yield this.onAfterItemLoad(t)}))}onBeforeItemLoad(t){return n(this,void 0,void 0,(function*(){}))}onItemLoad(t){return n(this,void 0,void 0,(function*(){const{settings:e}=t;void 0===e||void 0===e.on?this.logger.error(h.APP_PERMISSION_ERRORS.INVALID_SETTINGS):yield t.init()}))}onAfterItemLoad(t){return n(this,void 0,void 0,(function*(){}))}checkDependencies(t){if(!t)return this.logger.error("invalid item for check dependencies"),!1;const e=t.dependencies||[];if(!e||0===e.length)return!0;let i=e.length;const n=e.filter(t=>{if(l.loadedItems.has(t))return this.requireLoadList.has(t)&&this.requireLoadList.delete(t),!0;this.requireLoadList.add(t)}).length,s=n===i;return!s&&this.loadRetryTimes>this.loadRetryMax&&this.logger.error(`${(0,o.upperFirst)(t.name)} Require Item(s): ${Array.from(this.requireLoadList).join(", ")}`),s}onMessageReceived(t,e,i){}addListener(t,e){e&&e instanceof Function&&(this.emitter.removeAllListeners(t),this.emitter.on(t,e))}getSettingsForUpload(t,e,i){return n(this,void 0,void 0,(function*(){i()}))}onBeforeSetSettingsFromCloud(t){return n(this,void 0,void 0,(function*(){}))}onSetSettingsFromCloud({settings:t,stores:e}){return n(this,void 0,void 0,(function*(){yield this.setSetting(t),e&&Array.from(Object.entries(e)).forEach(([t,e])=>{this.setStore(t,e)})}))}onAfterSetSettingsFromCloud(t){return n(this,void 0,void 0,(function*(){}))}static mergeConfig(t,e){if(void 0===t)return e;if(["string","number","boolean"].includes(typeof t))return typeof t===typeof e?e:t;if(Array.isArray(t))return Array.isArray(e)?e.map((e,i)=>l.mergeConfig(t[i],e)):t;if((0,o.isPlainObject)(t)){if((0,o.isPlainObject)(e)){const i={};return Object.keys(t).forEach(n=>{i[n]=l.mergeConfig(t[n],e[n])}),i}return t}return t}simplifyConfig(t,i=e.SIMPLIFY_FILTER_LIST,n={}){return["string","number","boolean"].includes(typeof t)?t:(Object.keys(t).forEach(e=>{const s=t[e];if(i.indexOf(e)>-1)return!0;if(Array.isArray(s)&&s.length>0)n[e]=s.map(t=>this.simplifyConfig(t,i));else if((0,o.isPlainObject)(s)){const t=this.simplifyConfig(s,i,{});(0,o.isEmpty)(t)||(n[e]=t)}else n[e]=s}),n)}}e.Item=l,l.loadedItems=new Map,l.queryItemByName=(t,e)=>e?l.loadedItems.get(e):null},53709:(t,e)=>{let i;Object.defineProperty(e,"__esModule",{value:!0}),e.Logger=void 0;const n=()=>i||(i=/^dev/.test("production")?"debug":(/^pro/.test("production"),"error"));class s{constructor(t){this.origin=Object.assign({},console),this.options={debug:{log:!0,info:!0,warn:!0,error:!0},error:{log:!1,info:!1,warn:!0,error:!0}},this.level=n(),this.canWrite=t=>this.options[this.level]&&!!this.options[this.level][t],this.textWrapper=(...t)=>{if(this.name)return[this.name+":",...t]},this.name=t,this.debug={};for(let e in console)"function"===typeof console[e]&&(this.origin[e]=void 0);return this}info(...t){var e;this.canWrite("info")&&(null===(e=this.origin)||void 0===e||e.info(...this.textWrapper(...t)))}log(...t){var e;this.canWrite("log")&&(null===(e=this.origin)||void 0===e||e.log(...this.textWrapper(...t)))}warn(...t){var e;this.canWrite("warn")&&(null===(e=this.origin)||void 0===e||e.warn(...this.textWrapper(...t)))}error(...t){var e;this.canWrite("error")&&(null===(e=this.origin)||void 0===e||e.error(...this.textWrapper(...t)))}topic(t,...e){const i=this.origin.group.bind(window.console),n=this.origin.groupEnd.bind(window.console);i("%cTOPIC ~ "+t,"color: #f1e05a;"),e.map(t=>this.__groupItem(t,e.length>5)),n()}group(t,e){this.origin.group("%c"+t,"color: #3ed203;"),Array.from(Object.entries(e)).map(([t,e])=>{this.origin.log("%c"+t,"color: #fb8f07;",e)}),this.origin.groupEnd()}__groupItem(t,e=!1){const i=this.origin.log.bind(window.console),n=this.origin.group.bind(window.console),s=this.origin.groupCollapsed.bind(window.console),r=this.origin.groupEnd.bind(window.console);if("string"===typeof t||"boolean"===typeof t||"number"===typeof t)i("%c"+t.constructor.name,"color: #fb8f07;",t);else{let r=Array.from(Object.entries(t));e||r.length>3?s("%c"+t.constructor.name,"color: #e03bfd;"):n("%c"+t.constructor.name,"color: #e03bfd;"),r.map(([t,e])=>{i("%c"+t,"color: #fb8f07;",e)})}r()}}e.Logger=s}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var r=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}i.m=t,(()=>{var t=[];i.O=(e,n,s,r)=>{if(!n){var o=1/0;for(u=0;u<t.length;u++){for(var[n,s,r]=t[u],a=!0,c=0;c<n.length;c++)(!1&r||o>=r)&&Object.keys(i.O).every(t=>i.O[t](n[c]))?n.splice(c--,1):(a=!1,r<o&&(o=r));if(a){t.splice(u--,1);var d=s();void 0!==d&&(e=d)}}return e}r=r||0;for(var u=t.length;u>0&&t[u-1][2]>r;u--)t[u]=t[u-1];t[u]=[n,s,r]}})(),(()=>{i.n=t=>{var e=t&&t.__esModule?()=>t["default"]:()=>t;return i.d(e,{a:e}),e}})(),(()=>{i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}})(),(()=>{i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()})(),(()=>{i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e)})(),(()=>{i.r=t=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}})(),(()=>{i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t)})(),(()=>{i.j=869})(),(()=>{var t={869:0};i.O.j=e=>0===t[e];var e=(e,n)=>{var s,r,[o,a,c]=n,d=0;if(o.some(e=>0!==t[e])){for(s in a)i.o(a,s)&&(i.m[s]=a[s]);if(c)var u=c(i)}for(e&&e(n);d<o.length;d++)r=o[d],i.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return i.O(u)},n=self["webpackChunkbilibilihelper2"]=self["webpackChunkbilibilihelper2"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))})(),(()=>{i.nc=void 0})();var n=i.O(void 0,[196,133,110],()=>i(32559));n=i.O(n)})();